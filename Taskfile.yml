version: '3'

tasks:
  app:rails:new:
    requires:
      vars: [RAILS_VERSION]
    ##
    # TODO: Create Rails template.
    #
    cmds:
      ##
      # NOTE: Actually creates a new Rails app.
      #
      - gem install rails -v {{.RAILS_VERSION}}.0
      - mkdir -p app/rails_{{.RAILS_VERSION}}
      - cd app/rails_{{.RAILS_VERSION}} && rails _{{.RAILS_VERSION}}.0_ new app --api --database=mysql --skip-test --skip-git
      ##
      # NOTE: Removes `.ruby-version`.
      #
      - rm app/rails_{{.RAILS_VERSION}}/app/.ruby-version
      ##
      # NOTE: Places MySQL config.
      #
      - rm app/rails_{{.RAILS_VERSION}}/app/config/database.yml
      - cp app/rails_common/app/config/database.yml app/rails_{{.RAILS_VERSION}}/app/config/database.yml
      ##
      # NOTE: Replaces `ruby "x.x.x"` to `ruby ENV["RUBY_VERSION"].to_s`.
      #
      - cat app/rails_{{.RAILS_VERSION}}/app/Gemfile | ruby -pe 'gsub(/^ruby.*$/, "ruby ENV[\"RUBY_VERSION\"].to_s")' > app/rails_{{.RAILS_VERSION}}/app/Gemfile.temp
      - rm app/rails_{{.RAILS_VERSION}}/app/Gemfile
      - cp app/rails_{{.RAILS_VERSION}}/app/Gemfile.temp app/rails_{{.RAILS_VERSION}}/app/Gemfile
      - rm app/rails_{{.RAILS_VERSION}}/app/Gemfile.temp
      ##
      # NOTE: Adds `appraisal` to `Gemfile`.
      #
      - echo -e '\ngem "appraisal", "~> 2.5.0"' >> app/rails_{{.RAILS_VERSION}}/app/Gemfile
      ##
      # NOTE: Adds `redis-namespace` to `Gemfile`.
      #
      - echo -e '\ngem "redis-namespace", "~> 1.11.0"' >> app/rails_{{.RAILS_VERSION}}/app/Gemfile
      ##
      # NOTE: Creates a link to `Appraisals` inside Rails app.
      # - https://stackoverflow.com/a/44786859/12201472
      #
      - ln -f app/rails_common/app/Appraisals app/rails_{{.RAILS_VERSION}}/app/Appraisals
      ##
      # NOTE: Creates a link to `Sidekiq` configuration.
      # - https://github.com/sidekiq/sidekiq/wiki/Using-Redis#using-an-initializer
      #
      - ln -f app/rails_common/app/config/initializers/sidekiq.rb app/rails_{{.RAILS_VERSION}}/app/config/initializers/sidekiq.rb
      ##
      # NOTE: Appends `require_relative "../../../rails_common/database_prefix_env_variable"` to `config/boot.rb`.
      # - https://linuxize.com/post/bash-append-to-file/#append-to-a-file-using-the-redirection-operator-
      #
      - echo -e '\nrequire_relative "../../../rails_common/database_prefix_env_variable"' >> app/rails_{{.RAILS_VERSION}}/app/config/boot.rb
      ##
      # NOTE: Replaces original `README.md`.
      #
      - rm app/rails_{{.RAILS_VERSION}}/app/README.md
      - echo -e '# Setup\n\n- This app was created by `task app:rails:new RAILS_VERSION={{.RAILS_VERSION}}`.' >> app/rails_{{.RAILS_VERSION}}/app/README.md
      ##
      # NOTE: Prints further manual steps.
      #
      # NOTE: Multiline commands.
      # - https://github.com/go-task/task/issues/274
      #
      # NOTE: `command; cd $OLDPWD` docs.
      # - https://superuser.com/a/862551/1180656
      #
      - |
        echo -e 'Further manual steps:\n'
        echo -e '- Add `RUN cd rails_{{.RAILS_VERSION}}/app && bundle install` to all `docker/ruby_x.x/Dockerfile` files.'
        echo -e '- Update `gemfiles:clean` task.'
        echo -e '- Update `gemfiles:copy` task.'
        echo -e '- Introduce `docker:console:ruby_x.x:rails_{{.RAILS_VERSION}}` tasks.'

        echo -e '- Add `gem "rspec", "~> *.*.*", group: [:development, :test]` to Gemfile.'
        echo -e '- Add `gem "rspec-rails", "~> *.*.*", group: [:development, :test]` to Gemfile.'
        echo -e '- Execute `cd app/rails_{{.RAILS_VERSION}}/app && bundle exec rails generate rspec:install; cd $OLDPWD`.'
        echo -e '- Rebuild Docker images.'

  app:rails:delete:
    requires:
      vars: [RAILS_VERSION]
    cmds:
      - rm -rf app/rails_{{.RAILS_VERSION}}

  deps:install:
    requires:
      vars: [RAILS_VERSION]
    cmds:
      - cd app/rails_{{.RAILS_VERSION}}/app && bundle install
      - cd app/rails_{{.RAILS_VERSION}}/app && bundle exec appraisal install

  deps:install:all:
    cmds:
      - task: deps:install
        vars: { RAILS_VERSION: "5.2" }
      - task: deps:install
        vars: { RAILS_VERSION: "6.0" }
      - task: deps:install
        vars: { RAILS_VERSION: "6.1" }
      - task: deps:install
        vars: { RAILS_VERSION: "7.0" }
      - task: deps:install
        vars: { RAILS_VERSION: "7.1" }

  docker:bash:ruby:
    requires:
      vars: [RUBY_VERSION]
    cmds:
      - task: prepare:minimal
      - docker compose run --rm ruby_{{.RUBY_VERSION}} bash
    interactive: true
    internal: true

  docker:bash:ruby_2.7:
    cmds:
      - task: docker:bash:ruby
        vars: { RUBY_VERSION: "2.7" }

  docker:bash:ruby_3.0:
    cmds:
      - task: docker:bash:ruby
        vars: { RUBY_VERSION: "3.0" }

  docker:bash:ruby_3.1:
    cmds:
      - task: docker:bash:ruby
        vars: { RUBY_VERSION: "3.1" }

  docker:bash:ruby_3.2:
    cmds:
      - task: docker:bash:ruby
        vars: { RUBY_VERSION: "3.2" }

  docker:build:all:
    cmds:
      - task: prepare:full
      ##
      # - https://docs.docker.com/engine/reference/commandline/compose_build
      #
      - docker compose build
      ##
      # TODO: `vendor` folder to cache Ruby gems.
      #
      - docker compose run --rm ruby_2.7 bash -c "task deps:install:all"
      - docker compose run --rm ruby_3.0 bash -c "task deps:install:all"
      - docker compose run --rm ruby_3.1 bash -c "task deps:install:all"
      - docker compose run --rm ruby_3.2 bash -c "task deps:install:all"

  docker:console:ruby:rails:sidekiq:
    requires:
      vars: [RUBY_VERSION, RAILS_VERSION, SIDEKIQ_VERSION]
    cmds:
      - task: prepare:minimal
        vars: { RUBY_VERSION: "{{.RUBY_VERSION}}" }
      - |
        docker compose run --rm ruby_{{.RUBY_VERSION}} bash -c '
          APPRAISAL_NAME=$(SIDEKIQ_VERSION={{.SIDEKIQ_VERSION}} ruby appraisal_name.rb) \
            && echo -e "\n" \
            && echo -e "RUBY_VERSION    - \"{{.RUBY_VERSION}}\"" \
            && echo -e "RAILS_VERSION   - \"{{.RAILS_VERSION}}\"" \
            && echo -e "SIDEKIQ_VERSION - \"{{.SIDEKIQ_VERSION}}\"" \
            && echo -e "APPRAISAL_NAME  - \"${APPRAISAL_NAME}\"" \
            && echo -e "\n" \
            && cd app/rails_{{.RAILS_VERSION}}/app \
            && bundle exec appraisal generate \
            && bundle exec appraisal ${APPRAISAL_NAME} rails console
        '
    interactive: true
    internal: true

  docker:console:ruby_2.7:rails_5.2:sidekiq_5:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "5" }

  docker:console:ruby_2.7:rails_5.2:sidekiq_6:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "6" }

  docker:console:ruby_2.7:rails_5.2:sidekiq_7:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "7" }

  docker:console:ruby_2.7:rails_6.0:sidekiq_5:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "5" }

  docker:console:ruby_2.7:rails_6.0:sidekiq_6:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "6" }

  docker:console:ruby_2.7:rails_6.0:sidekiq_7:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "7" }

  docker:console:ruby_2.7:rails_6.1:sidekiq_5:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "5" }

  docker:console:ruby_2.7:rails_6.1:sidekiq_6:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "6" }

  docker:console:ruby_2.7:rails_6.1:sidekiq_7:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "7" }

  docker:console:ruby_2.7:rails_7.0:sidekiq_5:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "5" }

  docker:console:ruby_2.7:rails_7.0:sidekiq_6:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "6" }

  docker:console:ruby_2.7:rails_7.0:sidekiq_7:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "7" }

  docker:console:ruby_2.7:rails_7.1:sidekiq_5:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "5" }

  docker:console:ruby_2.7:rails_7.1:sidekiq_6:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "6" }

  docker:console:ruby_2.7:rails_7.1:sidekiq_7:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "7" }

  docker:console:ruby_3.0:rails_5.2:sidekiq_5:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "5" }

  docker:console:ruby_3.0:rails_5.2:sidekiq_6:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "6" }

  docker:console:ruby_3.0:rails_5.2:sidekiq_7:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "7" }

  docker:console:ruby_3.0:rails_6.0:sidekiq_5:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "5" }

  docker:console:ruby_3.0:rails_6.0:sidekiq_6:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "6" }

  docker:console:ruby_3.0:rails_6.0:sidekiq_7:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "7" }

  docker:console:ruby_3.0:rails_6.1:sidekiq_5:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "5" }

  docker:console:ruby_3.0:rails_6.1:sidekiq_6:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "6" }

  docker:console:ruby_3.0:rails_6.1:sidekiq_7:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "7" }

  docker:console:ruby_3.0:rails_7.0:sidekiq_5:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "5" }

  docker:console:ruby_3.0:rails_7.0:sidekiq_6:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "6" }

  docker:console:ruby_3.0:rails_7.0:sidekiq_7:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "7" }

  docker:console:ruby_3.0:rails_7.1:sidekiq_5:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "5" }

  docker:console:ruby_3.0:rails_7.1:sidekiq_6:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "6" }

  docker:console:ruby_3.0:rails_7.1:sidekiq_7:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "7" }

  docker:console:ruby_3.1:rails_5.2:sidekiq_5:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "5" }

  docker:console:ruby_3.1:rails_5.2:sidekiq_6:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "6" }

  docker:console:ruby_3.1:rails_5.2:sidekiq_7:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "7" }

  docker:console:ruby_3.1:rails_6.0:sidekiq_5:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "5" }

  docker:console:ruby_3.1:rails_6.0:sidekiq_6:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "6" }

  docker:console:ruby_3.1:rails_6.0:sidekiq_7:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "7" }

  docker:console:ruby_3.1:rails_6.1:sidekiq_5:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "5" }

  docker:console:ruby_3.1:rails_6.1:sidekiq_6:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "6" }

  docker:console:ruby_3.1:rails_6.1:sidekiq_7:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "7" }

  docker:console:ruby_3.1:rails_7.0:sidekiq_5:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "5" }

  docker:console:ruby_3.1:rails_7.0:sidekiq_6:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "6" }

  docker:console:ruby_3.1:rails_7.0:sidekiq_7:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "7" }

  docker:console:ruby_3.1:rails_7.1:sidekiq_5:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "5" }

  docker:console:ruby_3.1:rails_7.1:sidekiq_6:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "6" }

  docker:console:ruby_3.1:rails_7.1:sidekiq_7:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "7" }

  docker:console:ruby_3.2:rails_5.2:sidekiq_5:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "5" }

  docker:console:ruby_3.2:rails_5.2:sidekiq_6:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "6" }

  docker:console:ruby_3.2:rails_5.2:sidekiq_7:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "7" }

  docker:console:ruby_3.2:rails_6.0:sidekiq_5:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "5" }

  docker:console:ruby_3.2:rails_6.0:sidekiq_6:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "6" }

  docker:console:ruby_3.2:rails_6.0:sidekiq_7:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "7" }

  docker:console:ruby_3.2:rails_6.1:sidekiq_5:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "5" }

  docker:console:ruby_3.2:rails_6.1:sidekiq_6:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "6" }

  docker:console:ruby_3.2:rails_6.1:sidekiq_7:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "7" }

  docker:console:ruby_3.2:rails_7.0:sidekiq_5:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "5" }

  docker:console:ruby_3.2:rails_7.0:sidekiq_6:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "6" }

  docker:console:ruby_3.2:rails_7.0:sidekiq_7:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "7" }

  docker:console:ruby_3.2:rails_7.1:sidekiq_5:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "5" }

  docker:console:ruby_3.2:rails_7.1:sidekiq_6:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "6" }

  docker:console:ruby_3.2:rails_7.1:sidekiq_7:
    cmds:
      - task: docker:console:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "7" }

  docker:server:ruby:rails:sidekiq:
    requires:
      vars: [RUBY_VERSION, RAILS_VERSION, SIDEKIQ_VERSION, RAILS_PORT]
    cmds:
      - task: prepare:minimal
        vars: { RUBY_VERSION: "{{.RUBY_VERSION}}" }
      - rm app/rails_{{.RAILS_VERSION}}/app/tmp/pids/server.pid 2> /dev/null || true
      ##
      # NOTE: `-b 0.0.0.0` makes Rails server accessible from all hosts.
      # - https://stackoverflow.com/a/29084070/12201472
      #
      - |
        docker compose run \
          --rm \
          --publish {{.RAILS_PORT}}:{{.RAILS_PORT}} \
          ruby_{{.RUBY_VERSION}} bash -c '
            APPRAISAL_NAME=$(SIDEKIQ_VERSION={{.SIDEKIQ_VERSION}} ruby appraisal_name.rb) \
              && echo -e "\n" \
              && echo -e "RUBY_VERSION    - \"{{.RUBY_VERSION}}\"" \
              && echo -e "RAILS_VERSION   - \"{{.RAILS_VERSION}}\"" \
              && echo -e "SIDEKIQ_VERSION - \"{{.SIDEKIQ_VERSION}}\"" \
              && echo -e "APPRAISAL_NAME  - \"${APPRAISAL_NAME}\"" \
              && echo -e "\n" \
              && cd app/rails_{{.RAILS_VERSION}}/app \
              && bundle exec appraisal ${APPRAISAL_NAME} rails db:create \
              && bundle exec appraisal ${APPRAISAL_NAME} rails db:migrate \
              && bundle exec appraisal ${APPRAISAL_NAME} rails server --port {{.RAILS_PORT}} -b 0.0.0.0
          '
    interactive: true
    internal: true

  docker:server:ruby_2.7:rails_5.2:sidekiq_5:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "5" }

  docker:server:ruby_2.7:rails_5.2:sidekiq_6:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "6" }

  docker:server:ruby_2.7:rails_5.2:sidekiq_7:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "7" }

  docker:server:ruby_2.7:rails_6.0:sidekiq_5:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "5" }

  docker:server:ruby_2.7:rails_6.0:sidekiq_6:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "6" }

  docker:server:ruby_2.7:rails_6.0:sidekiq_7:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "7" }

  docker:server:ruby_2.7:rails_6.1:sidekiq_5:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "5" }

  docker:server:ruby_2.7:rails_6.1:sidekiq_6:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "6" }

  docker:server:ruby_2.7:rails_6.1:sidekiq_7:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "7" }

  docker:server:ruby_2.7:rails_7.0:sidekiq_5:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "5" }

  docker:server:ruby_2.7:rails_7.0:sidekiq_6:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "6" }

  docker:server:ruby_2.7:rails_7.0:sidekiq_7:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "7" }

  docker:server:ruby_2.7:rails_7.1:sidekiq_5:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "5" }

  docker:server:ruby_2.7:rails_7.1:sidekiq_6:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "6" }

  docker:server:ruby_2.7:rails_7.1:sidekiq_7:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "7" }

  docker:server:ruby_3.0:rails_5.2:sidekiq_5:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "5" }

  docker:server:ruby_3.0:rails_5.2:sidekiq_6:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "6" }

  docker:server:ruby_3.0:rails_5.2:sidekiq_7:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "7" }

  docker:server:ruby_3.0:rails_6.0:sidekiq_5:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "5" }

  docker:server:ruby_3.0:rails_6.0:sidekiq_6:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "6" }

  docker:server:ruby_3.0:rails_6.0:sidekiq_7:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "7" }

  docker:server:ruby_3.0:rails_6.1:sidekiq_5:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "5" }

  docker:server:ruby_3.0:rails_6.1:sidekiq_6:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "6" }

  docker:server:ruby_3.0:rails_6.1:sidekiq_7:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "7" }

  docker:server:ruby_3.0:rails_7.0:sidekiq_5:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "5" }

  docker:server:ruby_3.0:rails_7.0:sidekiq_6:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "6" }

  docker:server:ruby_3.0:rails_7.0:sidekiq_7:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "7" }

  docker:server:ruby_3.0:rails_7.1:sidekiq_5:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "5" }

  docker:server:ruby_3.0:rails_7.1:sidekiq_6:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "6" }

  docker:server:ruby_3.0:rails_7.1:sidekiq_7:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "7" }

  docker:server:ruby_3.1:rails_5.2:sidekiq_5:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "5" }

  docker:server:ruby_3.1:rails_5.2:sidekiq_6:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "6" }

  docker:server:ruby_3.1:rails_5.2:sidekiq_7:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "7" }

  docker:server:ruby_3.1:rails_6.0:sidekiq_5:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "5" }

  docker:server:ruby_3.1:rails_6.0:sidekiq_6:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "6" }

  docker:server:ruby_3.1:rails_6.0:sidekiq_7:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "7" }

  docker:server:ruby_3.1:rails_6.1:sidekiq_5:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "5" }

  docker:server:ruby_3.1:rails_6.1:sidekiq_6:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "6" }

  docker:server:ruby_3.1:rails_6.1:sidekiq_7:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "7" }

  docker:server:ruby_3.1:rails_7.0:sidekiq_5:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "5" }

  docker:server:ruby_3.1:rails_7.0:sidekiq_6:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "6" }

  docker:server:ruby_3.1:rails_7.0:sidekiq_7:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "7" }

  docker:server:ruby_3.1:rails_7.1:sidekiq_5:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "5" }

  docker:server:ruby_3.1:rails_7.1:sidekiq_6:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "6" }

  docker:server:ruby_3.1:rails_7.1:sidekiq_7:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "7" }

  docker:server:ruby_3.2:rails_5.2:sidekiq_5:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "5" }

  docker:server:ruby_3.2:rails_5.2:sidekiq_6:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "6" }

  docker:server:ruby_3.2:rails_5.2:sidekiq_7:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "7" }

  docker:server:ruby_3.2:rails_6.0:sidekiq_5:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "5" }

  docker:server:ruby_3.2:rails_6.0:sidekiq_6:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "6" }

  docker:server:ruby_3.2:rails_6.0:sidekiq_7:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "7" }

  docker:server:ruby_3.2:rails_6.1:sidekiq_5:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "5" }

  docker:server:ruby_3.2:rails_6.1:sidekiq_6:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "6" }

  docker:server:ruby_3.2:rails_6.1:sidekiq_7:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "7" }

  docker:server:ruby_3.2:rails_7.0:sidekiq_5:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "5" }

  docker:server:ruby_3.2:rails_7.0:sidekiq_6:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "6" }

  docker:server:ruby_3.2:rails_7.0:sidekiq_7:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "7" }

  docker:server:ruby_3.2:rails_7.1:sidekiq_5:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "5" }

  docker:server:ruby_3.2:rails_7.1:sidekiq_6:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "6" }

  docker:server:ruby_3.2:rails_7.1:sidekiq_7:
    cmds:
      - task: docker:server:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "7" }

  ##
  # NOTE: `docker:start:ruby_*.*:rails_*.*:sidekiq_*` commands were generated by the following script:
  #
  #   File.open("result.yml", "w+") do |file|
  #     ["2.7", "3.0", "3.1", "3.2"].each do |ruby|
  #       ["5.2", "6.0", "6.1", "7.0", "7.1"].each do |rails|
  #         ["5", "6", "7"].each do |sidekiq|
  #           file.puts <<~YAML
  #             docker:start:ruby_#{ruby}:rails_#{rails}:sidekiq_#{sidekiq}:
  #               cmds:
  #                 - task: docker:start:ruby:rails:sidekiq
  #                   vars: { RUBY_VERSION: "#{ruby}", RAILS_VERSION: "#{rails}", SIDEKIQ_VERSION: "#{sidekiq}" }
  #
  #           YAML
  #         end
  #       end
  #     end
  #   end
  #
  docker:start:ruby:rails:sidekiq:
    requires:
      vars: [RUBY_VERSION, RAILS_VERSION, SIDEKIQ_VERSION]
    cmds:
      - task: prepare:minimal
        vars: { RUBY_VERSION: "{{.RUBY_VERSION}}" }
      - |
        docker compose run --rm ruby_{{.RUBY_VERSION}} bash -c '
          APPRAISAL_NAME=$(SIDEKIQ_VERSION={{.SIDEKIQ_VERSION}} ruby appraisal_name.rb) \
            && echo -e "\n" \
            && echo -e "RUBY_VERSION    - \"{{.RUBY_VERSION}}\"" \
            && echo -e "RAILS_VERSION   - \"{{.RAILS_VERSION}}\"" \
            && echo -e "SIDEKIQ_VERSION - \"{{.SIDEKIQ_VERSION}}\"" \
            && echo -e "APPRAISAL_NAME  - \"${APPRAISAL_NAME}\"" \
            && echo -e "\n" \
            && cd app/rails_{{.RAILS_VERSION}}/app \
            && bundle exec appraisal generate \
            && bundle exec appraisal ${APPRAISAL_NAME} sidekiq
        '
    interactive: true
    internal: true

  docker:start:ruby_2.7:rails_5.2:sidekiq_5:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "5" }

  docker:start:ruby_2.7:rails_5.2:sidekiq_6:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "6" }

  docker:start:ruby_2.7:rails_5.2:sidekiq_7:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "7" }

  docker:start:ruby_2.7:rails_6.0:sidekiq_5:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "5" }

  docker:start:ruby_2.7:rails_6.0:sidekiq_6:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "6" }

  docker:start:ruby_2.7:rails_6.0:sidekiq_7:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "7" }

  docker:start:ruby_2.7:rails_6.1:sidekiq_5:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "5" }

  docker:start:ruby_2.7:rails_6.1:sidekiq_6:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "6" }

  docker:start:ruby_2.7:rails_6.1:sidekiq_7:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "7" }

  docker:start:ruby_2.7:rails_7.0:sidekiq_5:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "5" }

  docker:start:ruby_2.7:rails_7.0:sidekiq_6:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "6" }

  docker:start:ruby_2.7:rails_7.0:sidekiq_7:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "7" }

  docker:start:ruby_2.7:rails_7.1:sidekiq_5:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "5" }

  docker:start:ruby_2.7:rails_7.1:sidekiq_6:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "6" }

  docker:start:ruby_2.7:rails_7.1:sidekiq_7:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "2.7", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "7" }

  docker:start:ruby_3.0:rails_5.2:sidekiq_5:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "5" }

  docker:start:ruby_3.0:rails_5.2:sidekiq_6:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "6" }

  docker:start:ruby_3.0:rails_5.2:sidekiq_7:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "7" }

  docker:start:ruby_3.0:rails_6.0:sidekiq_5:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "5" }

  docker:start:ruby_3.0:rails_6.0:sidekiq_6:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "6" }

  docker:start:ruby_3.0:rails_6.0:sidekiq_7:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "7" }

  docker:start:ruby_3.0:rails_6.1:sidekiq_5:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "5" }

  docker:start:ruby_3.0:rails_6.1:sidekiq_6:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "6" }

  docker:start:ruby_3.0:rails_6.1:sidekiq_7:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "7" }

  docker:start:ruby_3.0:rails_7.0:sidekiq_5:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "5" }

  docker:start:ruby_3.0:rails_7.0:sidekiq_6:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "6" }

  docker:start:ruby_3.0:rails_7.0:sidekiq_7:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "7" }

  docker:start:ruby_3.0:rails_7.1:sidekiq_5:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "5" }

  docker:start:ruby_3.0:rails_7.1:sidekiq_6:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "6" }

  docker:start:ruby_3.0:rails_7.1:sidekiq_7:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.0", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "7" }

  docker:start:ruby_3.1:rails_5.2:sidekiq_5:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "5" }

  docker:start:ruby_3.1:rails_5.2:sidekiq_6:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "6" }

  docker:start:ruby_3.1:rails_5.2:sidekiq_7:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "7" }

  docker:start:ruby_3.1:rails_6.0:sidekiq_5:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "5" }

  docker:start:ruby_3.1:rails_6.0:sidekiq_6:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "6" }

  docker:start:ruby_3.1:rails_6.0:sidekiq_7:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "7" }

  docker:start:ruby_3.1:rails_6.1:sidekiq_5:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "5" }

  docker:start:ruby_3.1:rails_6.1:sidekiq_6:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "6" }

  docker:start:ruby_3.1:rails_6.1:sidekiq_7:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "7" }

  docker:start:ruby_3.1:rails_7.0:sidekiq_5:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "5" }

  docker:start:ruby_3.1:rails_7.0:sidekiq_6:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "6" }

  docker:start:ruby_3.1:rails_7.0:sidekiq_7:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "7" }

  docker:start:ruby_3.1:rails_7.1:sidekiq_5:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "5" }

  docker:start:ruby_3.1:rails_7.1:sidekiq_6:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "6" }

  docker:start:ruby_3.1:rails_7.1:sidekiq_7:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.1", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "7" }

  docker:start:ruby_3.2:rails_5.2:sidekiq_5:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "5" }

  docker:start:ruby_3.2:rails_5.2:sidekiq_6:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "6" }

  docker:start:ruby_3.2:rails_5.2:sidekiq_7:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "5.2", SIDEKIQ_VERSION: "7" }

  docker:start:ruby_3.2:rails_6.0:sidekiq_5:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "5" }

  docker:start:ruby_3.2:rails_6.0:sidekiq_6:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "6" }

  docker:start:ruby_3.2:rails_6.0:sidekiq_7:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "6.0", SIDEKIQ_VERSION: "7" }

  docker:start:ruby_3.2:rails_6.1:sidekiq_5:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "5" }

  docker:start:ruby_3.2:rails_6.1:sidekiq_6:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "6" }

  docker:start:ruby_3.2:rails_6.1:sidekiq_7:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "6.1", SIDEKIQ_VERSION: "7" }

  docker:start:ruby_3.2:rails_7.0:sidekiq_5:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "5" }

  docker:start:ruby_3.2:rails_7.0:sidekiq_6:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "6" }

  docker:start:ruby_3.2:rails_7.0:sidekiq_7:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "7.0", SIDEKIQ_VERSION: "7" }

  docker:start:ruby_3.2:rails_7.1:sidekiq_5:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "5" }

  docker:start:ruby_3.2:rails_7.1:sidekiq_6:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "6" }

  docker:start:ruby_3.2:rails_7.1:sidekiq_7:
    cmds:
      - task: docker:start:ruby:rails:sidekiq
        vars: { RUBY_VERSION: "3.2", RAILS_VERSION: "7.1", SIDEKIQ_VERSION: "7" }

  ##
  # NOTE: Dev only command.
  # NOTE: macOS specific command.
  # NOTE: Used by `tmuxinator`.
  #
  docker:start:
    cmds:
      - open -a Docker

  ##
  # NOTE: Dev only command.
  # NOTE: Used by `tmuxinator`.
  #
  editor:open:
    cmds:
      - code .

  gemfiles:clean:
    cmds:
      - rm app/rails_5.2/app/Gemfile.{{.RUBY_VERSION}} 2> /dev/null || true
      - rm app/rails_6.0/app/Gemfile.{{.RUBY_VERSION}} 2> /dev/null || true
      - rm app/rails_6.1/app/Gemfile.{{.RUBY_VERSION}} 2> /dev/null || true
      - rm app/rails_7.0/app/Gemfile.{{.RUBY_VERSION}} 2> /dev/null || true
      - rm app/rails_7.1/app/Gemfile.{{.RUBY_VERSION}} 2> /dev/null || true
      - rm app/rails_5.2/app/Gemfile.{{.RUBY_VERSION}}.lock 2> /dev/null || true
      - rm app/rails_6.0/app/Gemfile.{{.RUBY_VERSION}}.lock 2> /dev/null || true
      - rm app/rails_6.1/app/Gemfile.{{.RUBY_VERSION}}.lock 2> /dev/null || true
      - rm app/rails_7.0/app/Gemfile.{{.RUBY_VERSION}}.lock 2> /dev/null || true
      - rm app/rails_7.1/app/Gemfile.{{.RUBY_VERSION}}.lock 2> /dev/null || true
      - rm app/rails_5.2/app/Gemfile.lock 2> /dev/null || true
      - rm app/rails_6.0/app/Gemfile.lock 2> /dev/null || true
      - rm app/rails_6.1/app/Gemfile.lock 2> /dev/null || true
      - rm app/rails_7.0/app/Gemfile.lock 2> /dev/null || true
      - rm app/rails_7.1/app/Gemfile.lock 2> /dev/null || true
      - rm -rf app/rails_5.2/app/gemfiles
      - rm -rf app/rails_6.0/app/gemfiles
      - rm -rf app/rails_6.1/app/gemfiles
      - rm -rf app/rails_7.0/app/gemfiles
      - rm -rf app/rails_7.1/app/gemfiles

  gemfiles:clean:all:
    cmds:
      - task: gemfiles:clean
        vars: { RUBY_VERSION: "2.7" }
      - task: gemfiles:clean
        vars: { RUBY_VERSION: "3.0" }
      - task: gemfiles:clean
        vars: { RUBY_VERSION: "3.1" }
      - task: gemfiles:clean
        vars: { RUBY_VERSION: "3.2" }

  gemfiles:copy:
    cmds:
      - cp app/rails_5.2/app/Gemfile app/rails_5.2/app/Gemfile.{{.RUBY_VERSION}}
      - cp app/rails_6.0/app/Gemfile app/rails_6.0/app/Gemfile.{{.RUBY_VERSION}}
      - cp app/rails_6.1/app/Gemfile app/rails_6.1/app/Gemfile.{{.RUBY_VERSION}}
      - cp app/rails_7.0/app/Gemfile app/rails_7.0/app/Gemfile.{{.RUBY_VERSION}}
      - cp app/rails_7.1/app/Gemfile app/rails_7.1/app/Gemfile.{{.RUBY_VERSION}}

  gemfiles:copy:all:
    cmds:
      - task: gemfiles:copy
        vars: { RUBY_VERSION: "2.7" }
      - task: gemfiles:copy
        vars: { RUBY_VERSION: "3.0" }
      - task: gemfiles:copy
        vars: { RUBY_VERSION: "3.1" }
      - task: gemfiles:copy
        vars: { RUBY_VERSION: "3.2" }
  ##
  # NOTE: Dev only command.
  # NOTE: macOS specific command.
  # NOTE: Used by `tmuxinator`.
  #
  github:open:
    cmds:
      - open -na "Google Chrome" --args --new-window --incognito "https://github.com/marian13/convenient_service_integration"

  link:all:
    cmds:
      - task: link:appraisals
      - task: link:database
      - task: link:sidekiq

  link:appraisals:
    cmds:
      - ln -f app/rails_common/app/Appraisals app/rails_5.2/app/Appraisals
      - ln -f app/rails_common/app/Appraisals app/rails_6.0/app/Appraisals
      - ln -f app/rails_common/app/Appraisals app/rails_6.1/app/Appraisals
      - ln -f app/rails_common/app/Appraisals app/rails_7.0/app/Appraisals
      - ln -f app/rails_common/app/Appraisals app/rails_7.1/app/Appraisals

  link:database:
    cmds:
      - ln -f app/rails_common/app/config/database.yml app/rails_5.2/app/config/database.yml
      - ln -f app/rails_common/app/config/database.yml app/rails_6.0/app/config/database.yml
      - ln -f app/rails_common/app/config/database.yml app/rails_6.1/app/config/database.yml
      - ln -f app/rails_common/app/config/database.yml app/rails_7.0/app/config/database.yml
      - ln -f app/rails_common/app/config/database.yml app/rails_7.1/app/config/database.yml

  link:sidekiq:
    cmds:
      - ln -f app/rails_common/app/config/initializers/sidekiq.rb app/rails_5.2/app/config/initializers/sidekiq.rb
      - ln -f app/rails_common/app/config/initializers/sidekiq.rb app/rails_6.0/app/config/initializers/sidekiq.rb
      - ln -f app/rails_common/app/config/initializers/sidekiq.rb app/rails_6.1/app/config/initializers/sidekiq.rb
      - ln -f app/rails_common/app/config/initializers/sidekiq.rb app/rails_7.0/app/config/initializers/sidekiq.rb
      - ln -f app/rails_common/app/config/initializers/sidekiq.rb app/rails_7.1/app/config/initializers/sidekiq.rb

  ##
  # NOTE: `prepare:minimal` includes tasks that do NOT require docker images rebuild.
  #
  prepare:minimal:
    cmds:
      - task: gemfiles:copy:all
      - task: link:all

  ##
  # NOTE: `prepare:full` includes `prepare:minimal` + tasks that require docker images rebuild.
  #
  prepare:full:
    cmds:
      - task: gemfiles:clean:all
      - task: gemfiles:copy:all
      - task: link:all

  ##
  # NOTE: Dev only command.
  #
  tmuxinator:start:
    cmds:
      - direnv exec . tmuxinator start convenient_service_integration --project-config=.dev/.tmuxinator.yml
